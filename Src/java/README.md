# Overview

This is a multi-module project for CQL java libraries and proof-of-concept applications.
It contains the following sub-projects:

* **cql:** generates and builds Java lexers, parsers, listeners, and visitors using the CQL ANTLR4 grammar
* **quick:** generates and builds Java classes based on the QUICK XML schema
* **elm:** generates and builds Java classes based on the ELM XML schema
* **cql-to-elm:** generates Expression Logical Model (ELM) XML from CQL source
* **cql-to-js:** a JavaScript framework for executing CQL or ELM libraries

# Building the Project

This project uses the [Gradle](http://www.gradle.org/) build system.  A gradle wrapper, which automatically downloads
and uses an instance of gradle, is provided for convenience.  To build the project, simply execute the following
command:

    ./gradlew build

This will generate and build the ANTLR4 CQL artifacts, the JAXB QUICK artifacts, and the JAXB ELM artifacts.
It will also build and test the corresponding code libraries and applications.

To clean up the build artifacts:

    ./gradlew clean

# Generating IDE Projects

You can generate an IDE project for IntelliJ IDEa:

    ./gradlew idea

In addition to creating project modules for cql, quick, elm, and cql-to-elm, this will also import project
modules for the CQL grammar and examples.

# Executing the Sample Code

You can execute the sample code using the `gradlew` command or a script generated by gradle.

To execute the sample code using `gradlew`, you must execute the `run` command, using the project-specific 
path.  The following are current possibilities:

    ./gradlew :cql:run
    ./gradlew :cql-to-elm:run
    ./gradlew :tools:cql-parsetree:run

To execute the sample code using a script generated by gradle, first generate the scripts:

    ./gradlew installApp

Then execute the generated script (optionally passing in an argument).  The following example executes
the sample cql code with the path to a CQL file as an argument:

    ./cql/build/install/cql/bin/cql ../../Examples/ChlamydiaScreening_CQM.cql

You can also execute the cql-parsetree tool in a similar way:

    ./tools/cql-parsetree/build/install/cql-parsetree/bin/cql-parsetree ../../Examples/ChlamydiaScreening_CQM.cql

Lastly, you can run the script for the cql-to-elm project (which can also accept a file as an argument):

    ./cql-to-elm/build/install/cql-to-elm/bin/cql-to-elm

If you do not provide a file argument to cql-to-elm, it will expect CQL to be entered via the console.
Press `CTL-D` (Mac) or `CTL-Z` (Win) to stop typing CQL into the console.

# Using the CQL-to-JS Execution Framework

The CQL-to-JS framework contains Java code to translate CQL or ELM to a JSON representation.  It
also contains [CoffeeScript](http://coffeescript.org/) libraries that can execute the JSON
representation of the logic.  At this point, only a small subset has been implemented and it uses
a very simple JSON-based representation of patients.

## Generate a JSON Representation of CQL Logic

To generate a JSON representation of CQL logic, build and execute the cql-to-js app:

    ./gradlew :cql-to-js:installApp
    ./cql-to-js/build/install/cql-to-js/bin/cql-to-js ../../Examples/ChlamydiaScreening_CQM.cql

To save the results to a file, simply redirect output to a file.  Note that this is all likely to
change at some point in the future!